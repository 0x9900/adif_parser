#! /usr/bin/env python
# vim:fenc=utf-8
#
# Copyright Â© 2025 fred <github-fred@hidzz.com>
#
# Distributed under terms of the BSD 3-Clause license.

from io import StringIO
from pathlib import Path

from adif_parser import ParseADIF

LOG = '''Log exported from DXLog.net v2.6.13 at 2025-02-23 18:05:06Z
Contest: REF contest
<PROGRAMID:5>DXLOG
<PROGRAMVERSION:6>2.6.13
<CREATED_TIMESTAMP:15>20250223 180506
<ADIF_VER:5>3.1.5
<EOH>
<QSO_DATE:8>20250125 <TIME_ON:6>071343 <TIME_OFF:6>071343 <STATION_CALLSIGN:5>W6BSD <FREQ:7>14.0359 <BAND:3>20M <MODE:2>CW <CALL:5>F4KIY <RST_SENT:3>599 <RST_RCVD:3>599 <OPERATOR:5>W6BSD <APP_DXLOG_RCVD:2>57 <APP_DXLOG_POINTS:1>6 <APP_DXLOG_STNID:4>STN2 <APP_DXLOG_STN:1>R <APP_DXLOG_MULT1:2>57 <APP_DXLOG_NR:1>1 <MY_GRIDSQUARE:6>JN18PN <MY_ITU_ZONE:2>27 <MY_CQ_ZONE:2>14 <PFX:2>F4 <TX_PWR:3>500 <STX_STRING:2>77 <SRX_STRING:2>57 <EOR>
<QSO_DATE:8>20250125 <TIME_ON:6>071611 <TIME_OFF:6>071611 <STATION_CALLSIGN:5>W6BSD <FREQ:7>14.0361 <BAND:3>20M <MODE:2>CW <CALL:5>F4KIY <RST_SENT:3>599 <RST_RCVD:3>599 <OPERATOR:5>W6BSD <APP_DXLOG_RCVD:2>57 <APP_DXLOG_POINTS:1>0 <APP_DXLOG_STNID:4>STN2 <APP_DXLOG_STN:1>R <APP_DXLOG_NR:1>2 <MY_GRIDSQUARE:6>JN18PN <MY_ITU_ZONE:2>27 <MY_CQ_ZONE:2>14 <PFX:2>F4 <TX_PWR:3>500 <STX_STRING:2>77 <SRX_STRING:2>57 <EOR>
<QSO_DATE:8>20250125 <TIME_ON:6>071826 <TIME_OFF:6>071826 <STATION_CALLSIGN:5>W6BSD <FREQ:7>14.0200 <BAND:3>20M <MODE:2>CW <CALL:4>YT1A <RST_SENT:3>599 <RST_RCVD:3>599 <OPERATOR:5>W6BSD <APP_DXLOG_RCVD:3>005 <APP_DXLOG_POINTS:1>1 <APP_DXLOG_STNID:4>STN2 <APP_DXLOG_STN:1>R <APP_DXLOG_MULT2:2>YU <APP_DXLOG_NR:1>3 <MY_GRIDSQUARE:6>JN18PN <MY_ITU_ZONE:2>27 <MY_CQ_ZONE:2>14 <PFX:3>YT1 <TX_PWR:3>500 <STX_STRING:2>77 <SRX_STRING:3>005 <EOR>
<QSO_DATE:8>20250125 <TIME_ON:6>071850 <TIME_OFF:6>071850 <STATION_CALLSIGN:5>W6BSD <FREQ:7>14.0200 <BAND:3>20M <MODE:2>CW <CALL:5>LZ2MP <RST_SENT:3>599 <RST_RCVD:3>599 <OPERATOR:5>W6BSD <APP_DXLOG_RCVD:2>73 <APP_DXLOG_POINTS:1>1 <APP_DXLOG_STNID:4>STN2 <APP_DXLOG_STN:1>R <APP_DXLOG_MULT2:2>LZ <APP_DXLOG_NR:1>4 <MY_GRIDSQUARE:6>JN18PN <MY_ITU_ZONE:2>27 <MY_CQ_ZONE:2>14 <PFX:3>LZ2 <TX_PWR:3>500 <STX_STRING:2>77 <SRX_STRING:2>73 <EOR>
<QSO_DATE:8>20250125 <TIME_ON:6>071910 <TIME_OFF:6>071910 <STATION_CALLSIGN:5>W6BSD <FREQ:7>14.0200 <BAND:3>20M <MODE:2>CW <CALL:5>RX4HJ <RST_SENT:3>599 <RST_RCVD:3>599 <OPERATOR:5>W6BSD <APP_DXLOG_RCVD:3>018 <APP_DXLOG_POINTS:1>1 <APP_DXLOG_STNID:4>STN2 <APP_DXLOG_STN:1>R <APP_DXLOG_MULT2:2>UA <APP_DXLOG_NR:1>5 <MY_GRIDSQUARE:6>JN18PN <MY_ITU_ZONE:2>27 <MY_CQ_ZONE:2>14 <PFX:3>RX4 <TX_PWR:3>500 <STX_STRING:2>77 <SRX_STRING:3>018 <EOR>
<QSO_DATE:8>20250125 <TIME_ON:6>072034 <TIME_OFF:6>072034 <STATION_CALLSIGN:5>W6BSD <FREQ:7>14.0200 <BAND:3>20M <MODE:2>CW <CALL:4>R4AY <RST_SENT:3>599 <RST_RCVD:3>599 <OPERATOR:5>W6BSD <APP_DXLOG_RCVD:3>005 <APP_DXLOG_POINTS:1>1 <APP_DXLOG_STNID:4>STN2 <APP_DXLOG_STN:1>R <APP_DXLOG_NR:1>6 <MY_GRIDSQUARE:6>JN18PN <MY_ITU_ZONE:2>27 <MY_CQ_ZONE:2>14 <PFX:2>R4 <TX_PWR:3>500 <STX_STRING:2>77 <SRX_STRING:3>005 <EOR>
<QSO_DATE:8>20250125 <TIME_ON:6>072059 <TIME_OFF:6>072059 <STATION_CALLSIGN:5>W6BSD <FREQ:7>14.0200 <BAND:3>20M <MODE:2>CW <CALL:4>R3LC <RST_SENT:3>599 <RST_RCVD:3>599 <OPERATOR:5>W6BSD <APP_DXLOG_RCVD:3>008 <APP_DXLOG_POINTS:1>1 <APP_DXLOG_STNID:4>STN2 <APP_DXLOG_STN:1>R <APP_DXLOG_NR:1>7 <MY_GRIDSQUARE:6>JN18PN <MY_ITU_ZONE:2>27 <MY_CQ_ZONE:2>14 <PFX:2>R3 <TX_PWR:3>500 <STX_STRING:2>77 <SRX_STRING:3>008 <EOR>
<QSO_DATE:8>20250125 <TIME_ON:6>072128 <TIME_OFF:6>072128 <STATION_CALLSIGN:5>W6BSD <FREQ:7>14.0200 <BAND:3>20M <MODE:2>CW <CALL:4>YQ8E <RST_SENT:3>599 <RST_RCVD:3>599 <OPERATOR:5>W6BSD <APP_DXLOG_RCVD:3>017 <APP_DXLOG_POINTS:1>1 <APP_DXLOG_STNID:4>STN2 <APP_DXLOG_STN:1>R <APP_DXLOG_MULT2:2>YO <APP_DXLOG_NR:1>8 <MY_GRIDSQUARE:6>JN18PN <MY_ITU_ZONE:2>27 <MY_CQ_ZONE:2>14 <PFX:3>YQ8 <TX_PWR:3>500 <STX_STRING:2>77 <SRX_STRING:3>017 <EOR>
<QSO_DATE:8>20250125 <TIME_ON:6>072157 <TIME_OFF:6>072157 <STATION_CALLSIGN:5>W6BSD <FREQ:7>14.0200 <BAND:3>20M <MODE:2>CW <CALL:6>YO3GNF <RST_SENT:3>599 <RST_RCVD:3>599 <OPERATOR:5>W6BSD <APP_DXLOG_RCVD:3>011 <APP_DXLOG_POINTS:1>1 <APP_DXLOG_STNID:4>STN2 <APP_DXLOG_STN:1>R <APP_DXLOG_NR:1>9 <MY_GRIDSQUARE:6>JN18PN <MY_ITU_ZONE:2>27 <MY_CQ_ZONE:2>14 <PFX:3>YO3 <TX_PWR:3>500 <STX_STRING:2>77 <SRX_STRING:3>011 <EOR>
<QSO_DATE:8>20250125 <TIME_ON:6>072234 <TIME_OFF:6>072234 <STATION_CALLSIGN:5>W6BSD <FREQ:7>14.0200 <BAND:3>20M <MODE:2>CW <CALL:5>R6DMT <RST_SENT:3>599 <RST_RCVD:3>599 <OPERATOR:5>W6BSD <APP_DXLOG_RCVD:3>008 <APP_DXLOG_POINTS:1>1 <APP_DXLOG_STNID:4>STN2 <APP_DXLOG_STN:1>R <APP_DXLOG_NR:2>10 <MY_GRIDSQUARE:6>JN18PN <MY_ITU_ZONE:2>27 <MY_CQ_ZONE:2>14 <PFX:2>R6 <TX_PWR:3>500 <STX_STRING:2>77 <SRX_STRING:3>008 <EOR>
<QSO_DATE:8>20250222 <TIME_ON:6>060011 <TIME_OFF:6>060011 <STATION_CALLSIGN:5>W6BSD <FREQ:6>3.7300 <BAND:3>80M <MODE:3>SSB <CALL:5>F8GAF <RST_SENT:2>59 <RST_RCVD:2>59 <STX:1>1 <APP_DXLOG_NR:1>1 <MY_GRIDSQUARE:6>JN18PN <MY_ITU_ZONE:2>27 <MY_CQ_ZONE:2>14 <TX_PWR:3>500 <STX_STRING:2>77 <APP_DXLOG_RCVD:2>71 <PFX:2>F8 <APP_DXLOG_POINTS:1>6 <APP_DXLOG_STNID:4>STN7 <APP_DXLOG_STN:1>R <APP_DXLOG_MULT1:2>71 <EOR>
<QSO_DATE:8>20250222 <TIME_ON:6>060020 <TIME_OFF:6>060020 <STATION_CALLSIGN:5>W6BSD <FREQ:6>3.7300 <BAND:3>80M <MODE:3>SSB <CALL:5>F5TYQ <RST_SENT:2>59 <RST_RCVD:2>59 <STX:1>2 <APP_DXLOG_NR:1>2 <MY_GRIDSQUARE:6>JN18PN <MY_ITU_ZONE:2>27 <MY_CQ_ZONE:2>14 <TX_PWR:3>500 <STX_STRING:2>77 <APP_DXLOG_RCVD:2>59 <PFX:2>F5 <APP_DXLOG_POINTS:1>6 <APP_DXLOG_STNID:4>STN7 <APP_DXLOG_STN:1>R <APP_DXLOG_MULT1:2>59 <EOR>
<QSO_DATE:8>20250222 <TIME_ON:6>060055 <TIME_OFF:6>060055 <STATION_CALLSIGN:5>W6BSD <FREQ:6>3.7300 <BAND:3>80M <MODE:3>SSB <CALL:6>PE1EWR <RST_SENT:2>59 <RST_RCVD:2>59 <STX:1>3 <APP_DXLOG_NR:1>3 <MY_GRIDSQUARE:6>JN18PN <MY_ITU_ZONE:2>27 <MY_CQ_ZONE:2>14 <TX_PWR:3>500 <STX_STRING:2>77 <APP_DXLOG_RCVD:2>01 <PFX:3>PE1 <APP_DXLOG_POINTS:1>1 <APP_DXLOG_STNID:4>STN7 <APP_DXLOG_STN:1>R <APP_DXLOG_MULT2:2>PA <EOR>
<QSO_DATE:8>20250222 <TIME_ON:6>060106 <TIME_OFF:6>060106 <STATION_CALLSIGN:5>W6BSD <FREQ:6>3.7300 <BAND:3>80M <MODE:3>SSB <CALL:5>F4KJN <RST_SENT:2>59 <RST_RCVD:2>59 <STX:1>4 <APP_DXLOG_NR:1>4 <MY_GRIDSQUARE:6>JN18PN <MY_ITU_ZONE:2>27 <MY_CQ_ZONE:2>14 <TX_PWR:3>500 <STX_STRING:2>77 <APP_DXLOG_RCVD:2>46 <PFX:2>F4 <APP_DXLOG_POINTS:1>6 <APP_DXLOG_STNID:4>STN7 <APP_DXLOG_STN:1>R <APP_DXLOG_MULT1:2>46 <EOR>
<QSO_DATE:8>20250222 <TIME_ON:6>060121 <TIME_OFF:6>060121 <STATION_CALLSIGN:5>W6BSD <FREQ:6>3.7300 <BAND:3>80M <MODE:3>SSB <CALL:5>F8CRS <RST_SENT:2>59 <RST_RCVD:2>59 <STX:1>5 <APP_DXLOG_NR:1>5 <MY_GRIDSQUARE:6>JN18PN <MY_ITU_ZONE:2>27 <MY_CQ_ZONE:2>14 <TX_PWR:3>500 <STX_STRING:2>77 <APP_DXLOG_RCVD:2>67 <PFX:2>F8 <APP_DXLOG_POINTS:1>6 <APP_DXLOG_STNID:4>STN7 <APP_DXLOG_STN:1>R <APP_DXLOG_MULT1:2>67 <EOR>
<QSO_DATE:8>20250222 <TIME_ON:6>060132 <TIME_OFF:6>060132 <STATION_CALLSIGN:5>W6BSD <FREQ:6>3.7300 <BAND:3>80M <MODE:3>SSB <CALL:4>TM3P <RST_SENT:2>59 <RST_RCVD:2>59 <STX:1>6 <APP_DXLOG_NR:1>6 <MY_GRIDSQUARE:6>JN18PN <MY_ITU_ZONE:2>27 <MY_CQ_ZONE:2>14 <TX_PWR:3>500 <STX_STRING:2>77 <APP_DXLOG_RCVD:2>38 <PFX:3>TM3 <APP_DXLOG_POINTS:1>6 <APP_DXLOG_STNID:4>STN7 <APP_DXLOG_STN:1>R <APP_DXLOG_MULT1:2>38 <EOR>
<QSO_DATE:8>20250222 <TIME_ON:6>062221 <TIME_OFF:6>062221 <STATION_CALLSIGN:5>W6BSD <FREQ:6>7.1060 <BAND:3>40M <MODE:3>SSB <CALL:4>SE4E <RST_SENT:2>59 <RST_RCVD:2>59 <STX:2>68 <APP_DXLOG_NR:2>68 <MY_GRIDSQUARE:6>JN18PN <MY_ITU_ZONE:2>27 <MY_CQ_ZONE:2>14 <TX_PWR:3>500 <STX_STRING:2>77 <APP_DXLOG_RCVD:3>010 <PFX:3>SE4 <APP_DXLOG_POINTS:1>1 <APP_DXLOG_STNID:4>STN1 <APP_DXLOG_STN:1>R <EOR>
<QSO_DATE:8>20250222 <TIME_ON:6>062236 <TIME_OFF:6>062236 <STATION_CALLSIGN:5>W6BSD <FREQ:6>3.7300 <BAND:3>80M <MODE:3>SSB <CALL:5>F4BDG <RST_SENT:2>59 <RST_RCVD:2>59 <STX:2>69 <APP_DXLOG_NR:2>69 <MY_GRIDSQUARE:6>JN18PN <MY_ITU_ZONE:2>27 <MY_CQ_ZONE:2>14 <TX_PWR:3>500 <STX_STRING:2>77 <APP_DXLOG_RCVD:2>77 <PFX:2>F4 <APP_DXLOG_POINTS:1>6 <APP_DXLOG_STNID:4>STN7 <APP_DXLOG_STN:1>R <APP_DXLOG_MULT1:2>77 <EOR>
<QSO_DATE:8>20250222 <TIME_ON:6>062239 <TIME_OFF:6>062239 <STATION_CALLSIGN:5>W6BSD <FREQ:6>7.1060 <BAND:3>40M <MODE:3>SSB <CALL:5>DC5CH <RST_SENT:2>59 <RST_RCVD:2>59 <STX:2>70 <APP_DXLOG_NR:2>70 <MY_GRIDSQUARE:6>JN18PN <MY_ITU_ZONE:2>27 <MY_CQ_ZONE:2>14 <TX_PWR:3>500 <STX_STRING:2>77 <APP_DXLOG_RCVD:3>009 <PFX:3>DC5 <APP_DXLOG_POINTS:1>1 <APP_DXLOG_STNID:4>STN1 <APP_DXLOG_STN:1>R <EOR>
'''

RESULT = {'QSO_DATE': '20250125', 'TIME_ON': '071611', 'TIME_OFF': '071611',
          'STATION_CALLSIGN': 'W6BSD', 'FREQ': 14.0361, 'BAND': '20M', 'MODE': 'CW',
          'CALL': 'F4KIY', 'RST_SENT': 599.0, 'RST_RCVD': 599.0, 'OPERATOR': 'W6BSD',
          'APP_DXLOG_RCVD': 57.0, 'APP_DXLOG_POINTS': 0.0, 'APP_DXLOG_STNID': 'STN2',
          'APP_DXLOG_STN': 'R', 'APP_DXLOG_NR': 2.0, 'MY_GRIDSQUARE': 'JN18PN',
          'MY_ITU_ZONE': 27.0, 'MY_CQ_ZONE': 14.0, 'PFX': 'F4', 'TX_PWR': 500.0,
          'STX_STRING': 77.0, 'SRX_STRING': 57.0}


filename = Path('/tmp/fred.adi')

def test():
  with StringIO(LOG) as fd:
    adif = ParseADIF(fd)
    assert adif.contacts[1] == RESULT
    print('Test successful')


if __name__ == "__main__":
  test()
